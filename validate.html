<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お客様認証</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
    </style>
    <!-- Firebaseのライブラリを読み込み -->
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"></script>
</head>
<body>
    <h1>お客様認証</h1>
    <label for="customerPasscode">パスコードを入力してください:</label>
    <input type="text" id="customerPasscode" maxlength="6" required>
    <br>
    <button onclick="validateCustomer()">認証</button>
    <p id="validationResult"></p>

    <script>
        // Firebaseの設定
        const firebaseConfig = {
            apiKey: "AIzaSyCdiTGt2i-GTHgRopkIyLulnYjxUohGd4g",
            authDomain: "oic-ikayaki.firebaseapp.com",
            databaseURL: "https://oic-ikayaki-default-rtdb.firebaseio.com",
            projectId: "oic-ikayaki",
            storageBucket: "oic-ikayaki.firebasestorage.app",
            messagingSenderId: "244993702958",
            appId: "1:244993702958:web:d8bf9a3abe891ef184b3bf",
            measurementId: "G-CCTMTKSPD9"
        };

        // Firebaseを初期化
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function validateCustomer() {
            const inputPasscode = document.getElementById("customerPasscode").value;

            // Firebaseからパスコードを取得
            database.ref('passcodes/').once('value').then(snapshot => {
                let valid = false;
                snapshot.forEach(childSnapshot => {
                    const data = childSnapshot.val();
                    if (data.passcode === inputPasscode && !data.used) {
                        valid = true;
                        // パスコードを使用済みに更新
                        database.ref('passcodes/' + childSnapshot.key).update({ used: true });
                    }
                });
                
                if (valid) {
                    alert("認証成功です。");
                } else {
                    alert("認証失敗です。");
                }
            }).catch((error) => {
                console.error("パスコードの取得中にエラーが発生しました:", error);
            });
        }
    </script>
</body>
</html>
