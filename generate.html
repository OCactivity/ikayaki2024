<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>店舗スタッフ認証</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>店舗スタッフ認証</h1>

    <div id="staffLogin">
        <h2>スタッフログイン</h2>
        <label for="staffId">ID:</label>
        <input type="text" id="staffId" value="takumi" required>
        <br>
        <label for="staffPassword">パスワード:</label>
        <input type="password" id="staffPassword" value="2004" required>
        <br>
        <button onclick="login()">ログイン</button>
    </div>

    <div id="generateCode" class="hidden">
        <h2>パスコード生成</h2>
        <button onclick="generateCode()">パスコード生成</button>
        <p id="codeDisplay" class="hidden">生成されたパスコード: <span id="passcode"></span></p>
        <p>このパスコードをお客様に伝えてください。</p>
        <p>お客様の認証画面: <a id="customerLink" href="validate.html" target="_blank">ここをクリック</a></p>
    </div>

    <script>
        function login() {
            const id = document.getElementById("staffId").value;
            const password = document.getElementById("staffPassword").value;

            if (id === "takumi" && password === "2004") {
                document.getElementById("staffLogin").classList.add("hidden");
                document.getElementById("generateCode").classList.remove("hidden");
            } else {
                alert("IDまたはパスワードが間違っています。");
            }
        }

        function generateCode() {
            const passcode = Math.floor(100000 + Math.random() * 900000).toString();

            // JSONファイルにパスコードを保存（この部分はサーバーサイド処理が必要）
            fetch('passcodes.json')
                .then(response => response.json())
                .then(data => {
                    data.passcodes.push({ code: passcode, used: false });
                    return fetch('passcodes.json', {
                        method: 'PUT', // 注意: GitHub PagesではPUTはサポートされていません
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                })
                .then(() => {
                    document.getElementById("passcode").textContent = passcode;
                    document.getElementById("codeDisplay").classList.remove("hidden");
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
